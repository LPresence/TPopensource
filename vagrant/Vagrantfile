require 'vagrant-azure'

Vagrant.configure('2') do |conf|
  conf.vm.boot_timeout = 1000
  conf.vm.box = 'azure-dummy'
  conf.ssh.private_key_path = '~/.ssh/id_rsa'
  do_common_azure_stuff = Proc.new do |azure, override|

	azure.tenant_id = ENV['AZURE_TENANT_ID']
        azure.client_id = ENV['AZURE_CLIENT_ID']
        azure.client_secret = ENV['AZURE_CLIENT_SECRET']
        azure.subscription_id = ENV['AZURE_SUBSCRIPTION_ID']

        azure.vm_image_urn = 'Canonical:UbuntuServer:18.04-LTS:latest'
        azure.admin_username = 'adminynov' 
        azure.vm_password = 'Ynov01<3' 

        azure.location = 'northeurope' 
        azure.resource_group_name = 'LosCharros.com'

  end
  conf.vm.define 'first' do |cfg|
    cfg.vm.provider :azure do |azure, override|
      do_common_azure_stuff.call azure, override
      azure.vm_name = 'srv1'
      azure.vm_size = 'Standard_F1s'
      azure.virtual_network_name = 'vagrantVNET'
    end
  end

  conf.vm.define 'second' do |cfg|
    cfg.vm.provider :azure do |azure, override|
      do_common_azure_stuff.call azure, override
      azure.vm_name = 'srv2'
      azure.vm_size = 'Standard_F1s'
      azure.virtual_network_name = 'vagrantVNET'
    end
  end

  conf.vm.define 'third' do |cfg|
    cfg.vm.provider :azure do |azure, override|
      do_common_azure_stuff.call azure, override
      azure.vm_name = 'srv3'
      azure.vm_size = 'Standard_F1s'
      azure.virtual_network_name = 'vagrantVNET'
    end
  end

  # Executes powershell on the remote machine and returns the hostname
#  conf.vm.provision 'shell', inline: 'hostname'

end

